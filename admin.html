<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - agame.works</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Test Site Banner -->
    <div class="test-site-banner">
        <span class="banner-icon">‚ö†Ô∏è</span>
        TEST SITE - This is a development/demo site. Nothing here is legitimate or production-ready!
        <span class="banner-icon">‚ö†Ô∏è</span>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <a href="index.html" class="logo">agame.works</a>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
        <div class="auth-buttons">
            <a href="login.html" class="login-btn">Login</a>
            <a href="signup.html" class="signup-btn">Sign Up</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="admin-container">
            <div class="admin-header">
                <h2>Admin Panel</h2>
                <span id="adminWelcome"></span>
            </div>

            <!-- Admin Navigation -->
            <div class="admin-nav">
                <button class="active" data-section="dashboard">Dashboard</button>
                <button data-section="users">Users</button>
                <button data-section="messages">Messages</button>
                <button data-section="settings">Settings</button>
                <button data-section="devtools">üõ†Ô∏è Dev Tools</button>
            </div>

            <!-- Admin Panel Content -->
            <div class="admin-panel">
                <!-- Dashboard Section -->
                <div id="dashboard" class="admin-section active">
                    <h3>Dashboard</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="number" id="totalUsers">0</div>
                            <div class="label">Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="totalMessages">0</div>
                            <div class="label">Messages</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="unreadMessages">0</div>
                            <div class="label">Unread Messages</div>
                        </div>
                    </div>
                    <p>Welcome to the admin panel! Use the navigation above to manage your site.</p>
                </div>

                <!-- Users Section -->
                <div id="users" class="admin-section">
                    <h3>Manage Users</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Role</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Messages Section -->
                <div id="messages" class="admin-section">
                    <h3>Contact Messages</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Message</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="messagesTableBody">
                            <!-- Messages will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Settings Section -->
                <div id="settings" class="admin-section">
                    <h3>Settings</h3>
                    <div class="form-container" style="max-width: 100%;">
                        <div class="form-group">
                            <label>Site Name</label>
                            <input type="text" id="siteName" value="agame.works">
                        </div>
                        <div class="form-group">
                            <label>Admin Username</label>
                            <input type="text" id="adminUsername" readonly>
                        </div>
                        <button class="submit-btn" onclick="saveSettings()">Save Settings</button>
                    </div>
                </div>

                <!-- Dev Tools Section -->
                <div id="devtools" class="admin-section">
                    <h3>üõ†Ô∏è Developer Tools</h3>
                    <p style="margin-bottom: 1.5rem; opacity: 0.8;">Random development utilities for testing and debugging. Remember: This is a test site!</p>
                    
                    <div class="dev-tools-grid">
                        <!-- UUID Generator -->
                        <div class="dev-tool-card">
                            <h4>üîë UUID Generator</h4>
                            <p>Generate random UUIDs for testing purposes.</p>
                            <button class="dev-tool-btn" id="generateUuidBtn">Generate UUID</button>
                            <div class="dev-output" id="uuidOutput">Click button to generate...</div>
                        </div>

                        <!-- Lorem Ipsum Generator -->
                        <div class="dev-tool-card">
                            <h4>üìù Lorem Ipsum</h4>
                            <p>Generate placeholder text for layouts.</p>
                            <button class="dev-tool-btn" id="generateLoremBtn">Generate Text</button>
                            <div class="dev-output" id="loremOutput">Click button to generate...</div>
                        </div>

                        <!-- Random Color Generator -->
                        <div class="dev-tool-card">
                            <h4>üé® Color Generator</h4>
                            <p>Generate random hex colors for design.</p>
                            <button class="dev-tool-btn" id="generateColorBtn">Generate Color</button>
                            <div class="dev-output" id="colorOutput">Click button to generate...</div>
                        </div>

                        <!-- Timestamp Converter -->
                        <div class="dev-tool-card">
                            <h4>‚è∞ Timestamp Info</h4>
                            <p>Get current timestamp in various formats.</p>
                            <button class="dev-tool-btn" id="getTimestampBtn">Get Timestamp</button>
                            <div class="dev-output" id="timestampOutput">Click button to get timestamp...</div>
                        </div>

                        <!-- Base64 Encoder -->
                        <div class="dev-tool-card">
                            <h4>üîê Base64 Encoder</h4>
                            <p>Encode text to Base64 format.</p>
                            <input type="text" id="base64Input" placeholder="Enter text..." style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border-radius: 5px; border: none;">
                            <button class="dev-tool-btn" id="encodeBase64Btn">Encode</button>
                            <div class="dev-output" id="base64Output">Enter text and click encode...</div>
                        </div>

                        <!-- Random Password Generator -->
                        <div class="dev-tool-card">
                            <h4>üîí Password Generator</h4>
                            <p>Generate random secure passwords.</p>
                            <button class="dev-tool-btn" id="generatePasswordBtn">Generate Password</button>
                            <div class="dev-output" id="passwordOutput">Click button to generate...</div>
                        </div>

                        <!-- JSON Formatter -->
                        <div class="dev-tool-card">
                            <h4>üìã JSON Formatter</h4>
                            <p>Format and beautify JSON data.</p>
                            <textarea id="jsonInput" placeholder='{"key": "value"}' style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border-radius: 5px; border: none; min-height: 60px;"></textarea>
                            <button class="dev-tool-btn" id="formatJsonBtn">Format JSON</button>
                            <div class="dev-output" id="jsonOutput">Enter JSON and click format...</div>
                        </div>

                        <!-- Browser Info -->
                        <div class="dev-tool-card">
                            <h4>üåê Browser Info</h4>
                            <p>Get current browser and system information.</p>
                            <button class="dev-tool-btn" id="getBrowserInfoBtn">Get Info</button>
                            <div class="dev-output" id="browserInfoOutput">Click button to get info...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 agame.works. All rights reserved.</p>
    </footer>

    <script src="js/auth.js"></script>
    <script>
        // Check if user is admin
        document.addEventListener('DOMContentLoaded', function() {
            if (!Auth.isAdmin()) {
                alert('Access denied. Admin privileges required.');
                window.location.href = 'login.html';
                return;
            }

            const session = Auth.getSession();
            document.getElementById('adminWelcome').textContent = `Logged in as: ${session.username}`;
            document.getElementById('adminUsername').value = session.username;

            loadDashboard();
            loadUsers();
            loadMessages();
        });

        // Tab navigation
        document.querySelectorAll('.admin-nav button').forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons and sections
                document.querySelectorAll('.admin-nav button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked button and corresponding section
                this.classList.add('active');
                document.getElementById(this.dataset.section).classList.add('active');
            });
        });

        // Helper function to escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function loadDashboard() {
            const users = Auth.getAllUsers();
            const messages = Messages.getMessages();
            const unread = messages.filter(m => !m.read).length;

            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalMessages').textContent = messages.length;
            document.getElementById('unreadMessages').textContent = unread;
        }

        function loadUsers() {
            const users = Auth.getAllUsers();
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const tr = document.createElement('tr');
                
                const tdUsername = document.createElement('td');
                tdUsername.textContent = user.username;
                
                const tdRole = document.createElement('td');
                tdRole.textContent = user.role;
                
                const tdCreated = document.createElement('td');
                tdCreated.textContent = new Date(user.createdAt).toLocaleDateString();
                
                const tdActions = document.createElement('td');
                if (user.role !== 'admin') {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'action-btn delete-btn';
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.addEventListener('click', function() {
                        deleteUser(user.id);
                    });
                    tdActions.appendChild(deleteBtn);
                } else {
                    tdActions.textContent = '-';
                }
                
                tr.appendChild(tdUsername);
                tr.appendChild(tdRole);
                tr.appendChild(tdCreated);
                tr.appendChild(tdActions);
                tbody.appendChild(tr);
            });
        }

        function loadMessages() {
            const messages = Messages.getMessages();
            const tbody = document.getElementById('messagesTableBody');
            tbody.innerHTML = '';

            if (messages.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">No messages yet</td></tr>';
                return;
            }

            messages.reverse().forEach(msg => {
                const tr = document.createElement('tr');
                tr.style.opacity = msg.read ? '0.6' : '1';
                
                const tdName = document.createElement('td');
                tdName.textContent = msg.name;
                
                const tdEmail = document.createElement('td');
                tdEmail.textContent = msg.email;
                
                const tdMessage = document.createElement('td');
                const msgText = msg.message.length > 50 ? msg.message.substring(0, 50) + '...' : msg.message;
                tdMessage.textContent = msgText;
                
                const tdDate = document.createElement('td');
                tdDate.textContent = new Date(msg.createdAt).toLocaleDateString();
                
                const tdActions = document.createElement('td');
                if (!msg.read) {
                    const readBtn = document.createElement('button');
                    readBtn.className = 'action-btn edit-btn';
                    readBtn.textContent = 'Mark Read';
                    readBtn.addEventListener('click', function() {
                        markRead(msg.id);
                    });
                    tdActions.appendChild(readBtn);
                }
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'action-btn delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', function() {
                    deleteMessage(msg.id);
                });
                tdActions.appendChild(deleteBtn);
                
                tr.appendChild(tdName);
                tr.appendChild(tdEmail);
                tr.appendChild(tdMessage);
                tr.appendChild(tdDate);
                tr.appendChild(tdActions);
                tbody.appendChild(tr);
            });
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                Auth.deleteUser(userId);
                loadUsers();
                loadDashboard();
            }
        }

        function deleteMessage(msgId) {
            if (confirm('Are you sure you want to delete this message?')) {
                Messages.deleteMessage(msgId);
                loadMessages();
                loadDashboard();
            }
        }

        function markRead(msgId) {
            Messages.markAsRead(msgId);
            loadMessages();
            loadDashboard();
        }

        function saveSettings() {
            alert('Settings saved successfully!');
        }

        // Dev Tools Functionality
        // UUID Generator
        document.getElementById('generateUuidBtn').addEventListener('click', function() {
            const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            document.getElementById('uuidOutput').textContent = uuid;
        });

        // Lorem Ipsum Generator
        document.getElementById('generateLoremBtn').addEventListener('click', function() {
            const lorem = [
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
                "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.",
                "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum.",
                "Excepteur sint occaecat cupidatat non proident, sunt in culpa."
            ];
            const count = Math.floor(Math.random() * 3) + 2;
            const selectedSentences = lorem.sort(() => Math.random() - 0.5).slice(0, count);
            document.getElementById('loremOutput').textContent = selectedSentences.join(' ');
        });

        // Random Color Generator
        document.getElementById('generateColorBtn').addEventListener('click', function() {
            const hex = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
            const output = document.getElementById('colorOutput');
            output.textContent = hex + '\nRGB: ' + parseInt(hex.slice(1,3), 16) + ', ' + parseInt(hex.slice(3,5), 16) + ', ' + parseInt(hex.slice(5,7), 16);
            output.style.borderLeft = '4px solid ' + hex;
        });

        // Timestamp Info
        document.getElementById('getTimestampBtn').addEventListener('click', function() {
            const now = new Date();
            const info = [
                'Unix: ' + Math.floor(now.getTime() / 1000),
                'ISO: ' + now.toISOString(),
                'Local: ' + now.toLocaleString(),
                'UTC: ' + now.toUTCString()
            ];
            document.getElementById('timestampOutput').textContent = info.join('\n');
        });

        // Base64 Encoder
        document.getElementById('encodeBase64Btn').addEventListener('click', function() {
            const input = document.getElementById('base64Input').value;
            if (!input) {
                document.getElementById('base64Output').textContent = 'Please enter some text first!';
                return;
            }
            try {
                const encoded = btoa(input);
                document.getElementById('base64Output').textContent = 'Encoded: ' + encoded + '\nDecoded: ' + atob(encoded);
            } catch (e) {
                document.getElementById('base64Output').textContent = 'Error: Could not encode (non-ASCII characters?)';
            }
        });

        // Random Password Generator
        document.getElementById('generatePasswordBtn').addEventListener('click', function() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let passwords = [];
            for (let p = 0; p < 3; p++) {
                let password = '';
                for (let i = 0; i < 16; i++) {
                    password += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                passwords.push(password);
            }
            document.getElementById('passwordOutput').textContent = passwords.join('\n');
        });

        // JSON Formatter
        document.getElementById('formatJsonBtn').addEventListener('click', function() {
            const input = document.getElementById('jsonInput').value;
            if (!input) {
                document.getElementById('jsonOutput').textContent = 'Please enter JSON first!';
                return;
            }
            try {
                const parsed = JSON.parse(input);
                document.getElementById('jsonOutput').textContent = JSON.stringify(parsed, null, 2);
            } catch (e) {
                document.getElementById('jsonOutput').textContent = 'Error: Invalid JSON\n' + e.message;
            }
        });

        // Browser Info
        document.getElementById('getBrowserInfoBtn').addEventListener('click', function() {
            const info = [
                'User Agent: ' + navigator.userAgent,
                'Platform: ' + navigator.platform,
                'Language: ' + navigator.language,
                'Cookies: ' + (navigator.cookieEnabled ? 'Enabled' : 'Disabled'),
                'Screen: ' + screen.width + 'x' + screen.height,
                'Window: ' + window.innerWidth + 'x' + window.innerHeight,
                'Color Depth: ' + screen.colorDepth + '-bit'
            ];
            document.getElementById('browserInfoOutput').textContent = info.join('\n');
        });
    </script>
</body>
</html>
