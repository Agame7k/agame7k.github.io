<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[DEV] Admin Panel - agame.works</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/.dev-banner-auto.css">
</head>
<body>
    <!-- DEV MODE BANNER -->
    <div class="dev-banner">
        ðŸš§ DEV MODE - <a href="/">Go to Production</a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
        <a href="index.html" class="logo">agame.works</a>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
        <div class="auth-buttons">
            <a href="login.html" class="login-btn">Login</a>
            <a href="signup.html" class="signup-btn">Sign Up</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="admin-container">
            <div class="admin-header">
                <h2>Admin Panel</h2>
                <span id="adminWelcome"></span>
            </div>

            <!-- Admin Navigation -->
            <div class="admin-nav">
                <button class="active" data-section="dashboard">Dashboard</button>
                <button data-section="users">Users</button>
                <button data-section="messages">Messages</button>
                <button data-section="settings">Settings</button>
            </div>

            <!-- Admin Panel Content -->
            <div class="admin-panel">
                <!-- Dashboard Section -->
                <div id="dashboard" class="admin-section active">
                    <h3>Dashboard</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="number" id="totalUsers">0</div>
                            <div class="label">Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="totalMessages">0</div>
                            <div class="label">Messages</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="unreadMessages">0</div>
                            <div class="label">Unread Messages</div>
                        </div>
                    </div>
                    <p>Welcome to the admin panel! Use the navigation above to manage your site.</p>
                </div>

                <!-- Users Section -->
                <div id="users" class="admin-section">
                    <h3>Manage Users</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Role</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Messages Section -->
                <div id="messages" class="admin-section">
                    <h3>Contact Messages</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Message</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="messagesTableBody">
                            <!-- Messages will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Settings Section -->
                <div id="settings" class="admin-section">
                    <h3>Settings</h3>
                    <div class="form-container" style="max-width: 100%;">
                        <div class="form-group">
                            <label>Site Name</label>
                            <input type="text" id="siteName" value="agame.works">
                        </div>
                        <div class="form-group">
                            <label>Admin Username</label>
                            <input type="text" id="adminUsername" readonly>
                        </div>
                        <button class="submit-btn" onclick="saveSettings()">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 agame.works. All rights reserved.</p>
    </footer>

    <script src="js/auth.js"></script>
    <script>
        // Check if user is admin
        document.addEventListener('DOMContentLoaded', function() {
            if (!Auth.isAdmin()) {
                alert('Access denied. Admin privileges required.');
                window.location.href = 'login.html';
                return;
            }

            const session = Auth.getSession();
            document.getElementById('adminWelcome').textContent = `Logged in as: ${session.username}`;
            document.getElementById('adminUsername').value = session.username;

            loadDashboard();
            loadUsers();
            loadMessages();
        });

        // Tab navigation
        document.querySelectorAll('.admin-nav button').forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons and sections
                document.querySelectorAll('.admin-nav button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked button and corresponding section
                this.classList.add('active');
                document.getElementById(this.dataset.section).classList.add('active');
            });
        });

        // Helper function to escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function loadDashboard() {
            const users = Auth.getAllUsers();
            const messages = Messages.getMessages();
            const unread = messages.filter(m => !m.read).length;

            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalMessages').textContent = messages.length;
            document.getElementById('unreadMessages').textContent = unread;
        }

        function loadUsers() {
            const users = Auth.getAllUsers();
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const tr = document.createElement('tr');
                
                const tdUsername = document.createElement('td');
                tdUsername.textContent = user.username;
                
                const tdRole = document.createElement('td');
                tdRole.textContent = user.role;
                
                const tdCreated = document.createElement('td');
                tdCreated.textContent = new Date(user.createdAt).toLocaleDateString();
                
                const tdActions = document.createElement('td');
                if (user.role !== 'admin') {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'action-btn delete-btn';
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.addEventListener('click', function() {
                        deleteUser(user.id);
                    });
                    tdActions.appendChild(deleteBtn);
                } else {
                    tdActions.textContent = '-';
                }
                
                tr.appendChild(tdUsername);
                tr.appendChild(tdRole);
                tr.appendChild(tdCreated);
                tr.appendChild(tdActions);
                tbody.appendChild(tr);
            });
        }

        function loadMessages() {
            const messages = Messages.getMessages();
            const tbody = document.getElementById('messagesTableBody');
            tbody.innerHTML = '';

            if (messages.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">No messages yet</td></tr>';
                return;
            }

            messages.reverse().forEach(msg => {
                const tr = document.createElement('tr');
                tr.style.opacity = msg.read ? '0.6' : '1';
                
                const tdName = document.createElement('td');
                tdName.textContent = msg.name;
                
                const tdEmail = document.createElement('td');
                tdEmail.textContent = msg.email;
                
                const tdMessage = document.createElement('td');
                const msgText = msg.message.length > 50 ? msg.message.substring(0, 50) + '...' : msg.message;
                tdMessage.textContent = msgText;
                
                const tdDate = document.createElement('td');
                tdDate.textContent = new Date(msg.createdAt).toLocaleDateString();
                
                const tdActions = document.createElement('td');
                if (!msg.read) {
                    const readBtn = document.createElement('button');
                    readBtn.className = 'action-btn edit-btn';
                    readBtn.textContent = 'Mark Read';
                    readBtn.addEventListener('click', function() {
                        markRead(msg.id);
                    });
                    tdActions.appendChild(readBtn);
                }
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'action-btn delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', function() {
                    deleteMessage(msg.id);
                });
                tdActions.appendChild(deleteBtn);
                
                tr.appendChild(tdName);
                tr.appendChild(tdEmail);
                tr.appendChild(tdMessage);
                tr.appendChild(tdDate);
                tr.appendChild(tdActions);
                tbody.appendChild(tr);
            });
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                Auth.deleteUser(userId);
                loadUsers();
                loadDashboard();
            }
        }

        function deleteMessage(msgId) {
            if (confirm('Are you sure you want to delete this message?')) {
                Messages.deleteMessage(msgId);
                loadMessages();
                loadDashboard();
            }
        }

        function markRead(msgId) {
            Messages.markAsRead(msgId);
            loadMessages();
            loadDashboard();
        }

        function saveSettings() {
            alert('Settings saved successfully!');
        }
    </script>
</body>
</html>
